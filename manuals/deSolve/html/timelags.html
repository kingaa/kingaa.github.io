<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Time Lagged Values of State Variables and Derivatives.</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body><div class="container">

<table width="100%" summary="page for timelags {deSolve}"><tr><td>timelags {deSolve}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>
Time Lagged Values of State Variables and Derivatives.
</h2>

<h3>Description</h3>

<p>Functions <code>lagvalue</code> and <code>lagderiv</code> provide access to past
(lagged) values of state variables and derivatives.
</p>
<p>They are to be used with function <code>dede</code>, to solve delay differential 
equations.
</p>


<h3>Usage</h3>

<pre>
lagvalue(t, nr)
lagderiv(t, nr)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>t </code></td>
<td>
<p>the time for which the lagged value is wanted; this should
be no larger than the current simulation time and no smaller than the 
initial simulation time.  
</p>
</td></tr>
<tr valign="top"><td><code>nr </code></td>
<td>
<p>the number of the lagged value; if <code>NULL</code> then all state
variables or derivatives are returned.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>lagvalue</code> and <code>lagderiv</code> can only be called during the
integration, the lagged time should not be smaller than the initial
simulation time, nor should it be larger than the current simulation
time.
</p>
<p>Cubic Hermite interpolation is used to obtain an accurate interpolant
at the requested lagged time. 
</p>


<h3>Value</h3>

<p>a scalar (or vector) with the lagged value(s).
</p>


<h3>Author(s)</h3>

<p>Karline Soetaert &lt;karline.soetaert@nioz.nl&gt;</p>


<h3>See Also</h3>

<p><a href="../../deSolve/help/dede.html">dede</a>, for how to implement delay differential equations.
</p>


<h3>Examples</h3>

<pre>
## =============================================================================
## exercise 6 from Shampine and Thompson, 2000
## solving delay differential equations with dde23
##
## two lag values
## =============================================================================

##-----------------------------
## the derivative function
##-----------------------------
derivs &lt;- function(t, y, parms) { 
  History &lt;- function(t) c(cos(t), sin(t))
  if (t &lt; 1)
    lag1 &lt;- History(t - 1)[1]    
  else 
    lag1 &lt;- lagvalue(t - 1)[1] # returns a vector; select first element

  if (t &lt; 2)
    lag2 &lt;- History(t - 2)[2]
  else 
    lag2 &lt;- lagvalue(t - 2,2) # faster than lagvalue(t - 2)[2]

  dy1 &lt;- lag1 * lag2
  dy2 &lt;- -y[1] * lag2
  
  list(c(dy1, dy2), lag1 = lag1, lag2 = lag2)
}

##-----------------------------
## parameters
##-----------------------------

r &lt;- 3.5; m &lt;- 19

##-----------------------------
## initial values and times
##-----------------------------

yinit &lt;- c(y1 = 0, y2 = 0)
times &lt;- seq(0, 20, by = 0.01)

##-----------------------------
## solve the model  
##-----------------------------

yout &lt;- dede(y = yinit, times = times, func = derivs,
  parms = NULL, atol = 1e-9)

##-----------------------------
## plot results
##-----------------------------

plot(yout, type = "l", lwd = 2)

## =============================================================================
## The predator-prey model with time lags, from Hale
## problem 1 from Shampine and Thompson, 2000
## solving delay differential equations with dde23
##
## a vector with lag valuess
## =============================================================================

##-----------------------------
## the derivative function
##-----------------------------
predprey &lt;- function(t, y, parms) {
  tlag &lt;- t - 1
  if (tlag &lt; 0)
    ylag &lt;- c(80, 30)
  else 
    ylag &lt;- lagvalue(tlag)  # returns a vector
  
  dy1 &lt;- a * y[1] * (1 - y[1]/m) + b * y[1] * y[2]
  dy2 &lt;- c * y[2] + d * ylag[1] * ylag[2]
  list(c(dy1, dy2))
}

##-----------------------------
## parameters
##-----------------------------

a &lt;- 0.25; b &lt;- -0.01; c &lt;- -1 ; d &lt;- 0.01; m &lt;- 200

##-----------------------------
## initial values and times
##-----------------------------

yinit &lt;- c(y1 = 80, y2 = 30)
times &lt;- seq(0, 100, by = 0.01)

#-----------------------------
# solve the model  
#-----------------------------

yout &lt;- dede(y = yinit, times = times, func = predprey, parms = NULL)

##-----------------------------
## display, plot results
##-----------------------------

plot(yout, type = "l", lwd = 2, main = "Predator-prey model", mfrow = c(2, 2))
plot(yout[,2], yout[,3], xlab = "y1", ylab = "y2", type = "l", lwd = 2)

diagnostics(yout)

## =============================================================================
##
## A neutral delay differential equation (lagged derivative)   
##  y't = -y'(t-1), y(t) t &lt; 0 = 1/t
##
## =============================================================================

##-----------------------------
## the derivative function
##-----------------------------
derivs &lt;- function(t, y, parms) {
  tlag &lt;- t - 1
  if (tlag &lt; 0)
    dylag &lt;- -1
  else
    dylag &lt;- lagderiv(tlag)

  list(c(dy = -dylag), dylag = dylag)
}

##-----------------------------
## initial values and times
##-----------------------------

yinit &lt;- 0
times &lt;- seq(0, 4, 0.001)

##-----------------------------
## solve the model  
##-----------------------------

yout &lt;- dede(y = yinit, times = times, func = derivs, parms = NULL)

##-----------------------------
## display, plot results
##-----------------------------

plot(yout, type = "l", lwd = 2)
</pre>

<hr /><div style="text-align: center;">[Package <em>deSolve</em> version 1.30 <a href="00Index.html">Index</a>]</div>
</div></body></html>
